<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Lotus' Blog</title>
</head>
<body>
    <h1>Lotus' Posting Wall</h1>

    <div id="posts-container"></div> <!-- Container for posts -->

    <script>
        async function fetchPosts() {
            try {
                const response = await fetch('posts.json'); // Fetch JSON file
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json(); // Parse JSON
                
                // Sort posts by ID (latest first)
                data.posts.sort((a, b) => b.id - a.id);
                
                const postsContainer = document.getElementById('posts-container');

                // Clear the container
                postsContainer.innerHTML = '';

                // Iterate through posts and display them
                data.posts.forEach(post => {
                    const postDiv = document.createElement('div');
                    postDiv.classList.add('post');

                    // Calculate the time ago
                    const timeAgo = getTimeAgo(post.timestamp);

                    postDiv.innerHTML = `
                        <img src="https://cdn.discordapp.com/guilds/820745488231301210/users/591534252307513347/avatars/c7d07768cde4265f0faa51f502ab3551.webp?size=1024&format=webp&width=480&height=480" alt="Profile Picture" class="pfp">
                        <div class="post-content">
                            <a href="profile.html" class="display-name">${post.author}</a>
                            <a href="profile.html" class="username">${post.username}</a>
                            <span class="timestamp">${timeAgo} ago</span>
                            <p>${post.content}</p>
                            <a href="${post.viewPostLink}" class="view-post">View Post</a>
                    `;

                    // Check if there's an attachment
                    if (post.attachment) {
                        if (post.attachment.type === 'image') {
                            postDiv.innerHTML += `<img src="${post.attachment.url}" alt="Attachment" class="attachment-image">`;
                        } else if (post.attachment.type === 'video') {
                            postDiv.innerHTML += `
                                <video controls class="attachment-video">
                                    <source src="${post.attachment.url}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            `;
                        }
                    }

                    postDiv.innerHTML += `</div>`; // Close post-content div
                    postsContainer.appendChild(postDiv); // Add post to container
                });
            } catch (error) {
                console.error('Error fetching posts:', error);
                document.getElementById('posts-container').innerHTML = '<p>Failed to load posts.</p>';
            }
        }

        function getTimeAgo(timestamp) {
            const now = new Date(); // Current date and time
            const postDate = new Date(timestamp); // Convert the timestamp to a Date object
            const seconds = Math.floor((now - postDate) / 1000); // Calculate the difference in seconds

            let interval = Math.floor(seconds / 31536000); // Years
            if (interval > 1) return `${interval} years ago`;
            if (interval === 1) return "1 year ago";

            interval = Math.floor(seconds / 2592000); // Months
            if (interval > 1) return `${interval} months ago`;
            if (interval === 1) return "1 month ago";

            interval = Math.floor(seconds / 86400); // Days
            if (interval > 1) return `${interval} days ago`;
            if (interval === 1) return "1 day ago";

            interval = Math.floor(seconds / 3600); // Hours
            if (interval > 1) return `${interval} hours ago`;
            if (interval === 1) return "1 hour ago";

            interval = Math.floor(seconds / 60); // Minutes
            if (interval > 1) return `${interval} minutes ago`;
            if (interval === 1) return "1 minute ago";

            return seconds + " seconds ago"; // Fallback for seconds
        }

        fetchPosts(); // Call the function to fetch and display posts
    </script>
</body>
</html>
